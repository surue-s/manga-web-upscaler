# Manifest V3 Extension Architecture Diagram

## API Permission Boundaries

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          MANIFEST V3 EXTENSION                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BROWSER UI & TOOLBAR                                                      â”‚
â”‚                                                                            â”‚
â”‚  [ğŸ“±] Manga Upscaler Icon â†’ Opens Popup Window                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚   POPUP WINDOW      â”‚
                           â”‚  (popup/popup.js)   â”‚
                           â”‚                     â”‚
                           â”‚ [Detect Images]     â”‚
                           â”‚ [Upscale Single]    â”‚
                           â”‚ [Progress: 0%]      â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                      chrome.runtime.sendMessage()
                                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  SERVICE WORKER          â”‚
          â”‚ (service-worker.js)      â”‚
          â”‚                          â”‚
          â”‚ - Message Router âœ“       â”‚
          â”‚ - State Manager âœ“        â”‚
          â”‚ - Web Worker Mgmt âœ—      â”‚ â† CANNOT create workers here!
          â”‚                          â”‚
          â”‚ Receives: DETECT_IMAGES  â”‚
          â”‚ Receives: UPSCALE_SINGLE â”‚
          â”‚ Tracks: modelLoaded,     â”‚
          â”‚         workerReady      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         chrome.tabs.sendMessage()
                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONTENT SCRIPT      â”‚    â”‚  OTHER TABS          â”‚
â”‚ (content/content.js) â”‚    â”‚ (if active)          â”‚
â”‚                      â”‚    â”‚                      â”‚
â”‚ DOM Access âœ“         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Image Extract âœ“      â”‚
â”‚ Web Worker Mgmt âœ“    â”‚ â† CAN create workers here!
â”‚                      â”‚
â”‚ Functions:           â”‚
â”‚ â€¢ detectImages()     â”‚
â”‚ â€¢ extractImageData() â”‚
â”‚ â€¢ initializeWorker() â”‚ â”€â”€â”
â”‚ â€¢ sendToWorker()     â”‚   â”‚
â”‚ â€¢ upscaleImage()     â”‚   â”‚
â”‚ â€¢ replaceImage()     â”‚   â”‚
â”‚ â€¢ tensorConversion() â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
           â”‚               â”‚
    worker.postMessage()   â”‚
           â”‚               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WEB WORKER                          â”‚
â”‚  (worker/inference-worker.js)        â”‚
â”‚                                      â”‚
â”‚  Runs in: Separate Thread            â”‚
â”‚  Access: No DOM, No chrome.* APIs    â”‚
â”‚                                      â”‚
â”‚  Functions:                          â”‚
â”‚  â€¢ loadONNXRuntime()                 â”‚
â”‚  â€¢ loadModel()                       â”‚
â”‚  â€¢ runInference()                    â”‚
â”‚  â€¢ onmessage handler                 â”‚
â”‚                                      â”‚
â”‚  Loads:                              â”‚
â”‚  - ONNX Runtime (CDN)                â”‚
â”‚  - ESRGAN Model (extension/models)   â”‚
â”‚                                      â”‚
â”‚  Performs:                           â”‚
â”‚  - 4x Image Upscaling                â”‚
â”‚  - Tensor Processing                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Sequence

```
USER INTERACTION                  CHROME EXTENSION               WEB WORKER
     â”‚                                  â”‚                             â”‚
     â”‚ Click "Upscale Single"           â”‚                             â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                             â”‚
     â”‚                            Popupâ”‚                             â”‚
     â”‚                          (receives)                            â”‚
     â”‚                                  â”‚                             â”‚
     â”‚                    Send message to                            â”‚
     â”‚                    Service Workerâ”‚                             â”‚
     â”‚                                  â”‚                             â”‚
     â”‚                            Serviceâ”‚                            â”‚
     â”‚                            Workerâ”‚                            â”‚
     â”‚                          (routes to                           â”‚
     â”‚                           Content                             â”‚
     â”‚                           Script)â”‚                             â”‚
     â”‚                                  â”‚                             â”‚
     â”‚                              Send message to                  â”‚
     â”‚                              Content Scriptâ†’ Content          â”‚
     â”‚                                  â”‚   Script  â”‚                â”‚
     â”‚                                  â”‚  (receives, prepares)      â”‚
     â”‚                                  â”‚           â”‚                â”‚
     â”‚                                  â”‚        Extract image data  â”‚
     â”‚                                  â”‚        from DOM            â”‚
     â”‚                                  â”‚        Convert to tensor   â”‚
     â”‚                                  â”‚                â”‚            â”‚
     â”‚                                  â”‚        Create worker if    â”‚
     â”‚                                  â”‚        not exists          â”‚
     â”‚                                  â”‚                â”‚            â”‚
     â”‚                                  â”‚        Send to workerâ”€â”€â”€â”€â”€â”€â†’â”‚
     â”‚                                  â”‚                â”‚    tensor, dims
     â”‚                                  â”‚                â”‚            â”‚
     â”‚                                  â”‚                â”‚ Load ONNX  â”‚
     â”‚                                  â”‚                â”‚ Runtime    â”‚
     â”‚                                  â”‚                â”‚            â”‚
     â”‚                                  â”‚                â”‚ Load ONNX  â”‚
     â”‚                                  â”‚                â”‚ Model      â”‚
     â”‚                                  â”‚                â”‚            â”‚
     â”‚                                  â”‚                â”‚ Run 4x     â”‚
     â”‚                                  â”‚                â”‚ inference  â”‚
     â”‚                                  â”‚                â”‚            â”‚
     â”‚                                  â”‚    Return resultâ†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                                  â”‚ (output tensor,  dimensions â”‚
     â”‚                                  â”‚  width, height)             â”‚
     â”‚                                  â”‚                â”‚            â”‚
     â”‚                      Convert to ImageData          â”‚            â”‚
     â”‚                      Replace DOM image element     â”‚            â”‚
     â”‚                      Update popup progress         â”‚            â”‚
     â”‚                                  â”‚                â”‚            â”‚
     â”‚â†â”€â”€â”€â”€â”€â”€â”€ Success Response â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚            â”‚
     â”‚                                  â”‚                â”‚            â”‚
     â”‚ Image Upscaled! (4x size)        â”‚                â”‚            â”‚
     â”‚                                  â”‚                â”‚            â”‚

TIMELINE:
- First run:  30-60 seconds (ONNX initialization)
- Cached:     5-15 seconds  (model already loaded)
```

## Request/Response Message Types

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POPUP â†’ SERVICE WORKER                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                                                   â”‚
â”‚   type: 'DETECT_IMAGES' | 'UPSCALE_SINGLE' | 'UPSCALE_ALL'        â”‚
â”‚ }                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SERVICE WORKER â†’ CONTENT SCRIPT                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                                                   â”‚
â”‚   type: 'DETECT_IMAGES' | 'UPSCALE_SINGLE',                       â”‚
â”‚   payload: { ... }                                                  â”‚
â”‚ }                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONTENT SCRIPT â†’ WEB WORKER                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                                                   â”‚
â”‚   type: 'INFERENCE_REQUEST',                                       â”‚
â”‚   messageId: <timestamp>,                                          â”‚
â”‚   payload: {                                                       â”‚
â”‚     tensor: Float32Array,    // as regular array                   â”‚
â”‚     dims: [1, 3, H, W],      // batch, channels, height, width     â”‚
â”‚     originalWidth: <px>,                                           â”‚
â”‚     originalHeight: <px>                                           â”‚
â”‚   }                                                                 â”‚
â”‚ }                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WEB WORKER â†’ CONTENT SCRIPT                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                                                   â”‚
â”‚   type: 'INFERENCE_COMPLETE' | 'INFERENCE_ERROR' |                â”‚
â”‚         'MODEL_LOADED' | 'MODEL_LOAD_ERROR',                       â”‚
â”‚   messageId: <timestamp>,  // matches request                      â”‚
â”‚   payload: {                                                       â”‚
â”‚     tensor: Float32Array,    // as regular array (if success)      â”‚
â”‚     width: <upscaled_px>,                                          â”‚
â”‚     height: <upscaled_px>,                                         â”‚
â”‚     error: 'error message'   // if error type                      â”‚
â”‚   }                                                                 â”‚
â”‚ }                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONTENT SCRIPT â†’ SERVICE WORKER (status updates)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                                                   â”‚
â”‚   type: 'UPDATE_MODEL_STATUS',                                     â”‚
â”‚   payload: {                                                       â”‚
â”‚     loaded: boolean,  // model fully loaded                        â”‚
â”‚     ready: boolean    // worker ready for inference                â”‚
â”‚   }                                                                 â”‚
â”‚ }                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Memory Layout During Inference

```
BROWSER PROCESS
â”œâ”€ Service Worker Context
â”‚  â”œâ”€ modelLoaded: boolean
â”‚  â”œâ”€ workerReady: boolean
â”‚  â””â”€ pendingRequests: Map
â”‚
â”œâ”€ Content Script Context (Isolated)
â”‚  â”œâ”€ inferenceWorker: Worker instance
â”‚  â”œâ”€ modelLoaded: boolean
â”‚  â”œâ”€ workerReady: boolean
â”‚  â”œâ”€ upscaledImages: WeakSet
â”‚  â””â”€ DOM access for:
â”‚     â”œâ”€ detectImages()
â”‚     â”œâ”€ extractImageData()
â”‚     â””â”€ replaceImage()
â”‚
â””â”€ Web Worker Thread (Separate Thread)
   â”œâ”€ ort: ONNX Runtime instance
   â”‚  â””â”€ WASM engine (~100MB loaded)
   â”‚
   â”œâ”€ session: ONNX Session instance
   â”‚  â””â”€ ESRGAN model (~500MB loaded)
   â”‚
   â””â”€ Runtime Tensors (during inference)
      â”œâ”€ Input: [1, 3, H, W] float32
      â””â”€ Output: [1, 3, H*4, W*4] float32

TOTAL MEMORY ~500-700MB during inference
(Most is WASM engine + model in worker thread)
```

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Error in Web Worker                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Worker catches error  â”‚
         â”‚ postMessage({         â”‚
         â”‚  type: '*_ERROR',     â”‚
         â”‚  payload: {error}     â”‚
         â”‚ })                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Content script        â”‚
         â”‚ receives error        â”‚
         â”‚ Timeout handling:     â”‚
         â”‚ 60 second limit       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Content script        â”‚
         â”‚ rejects promise       â”‚
         â”‚ upscaleImage() catchesâ”‚
         â”‚ returns error to user â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Popup displays error  â”‚
         â”‚ User can retry        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Boundaries

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘               MANIFEST V3 SECURITY MODEL                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                   â•‘
â•‘  SERVICE WORKER  â†â†’  CONTENT SCRIPT  â†â†’  WEB WORKER              â•‘
â•‘                                                                   â•‘
â•‘  Isolated    Message Passing    Isolated                         â•‘
â•‘  Context     (Secure)           Context                          â•‘
â•‘                                                                   â•‘
â•‘  â€¢ No DOM                       â€¢ Has DOM      â€¢ No DOM           â•‘
â•‘  â€¢ No direct                    â€¢ Can create   â€¢ Can't            â•‘
â•‘    workers                        workers       communicate       â•‘
â•‘  â€¢ Can route   â†---message--->  â€¢ Can run      â€¢ With page        â•‘
â•‘    messages                      page logic    globals            â•‘
â•‘  â€¢ Manages     â†---message--->  â€¢ Can extract  â€¢ Only via         â•‘
â•‘    state                         images        postMessage()      â•‘
â•‘                                                                   â•‘
â•‘  All data transferred between contexts is COPIED (not shared)    â•‘
â•‘  This prevents accidental or malicious data leakage              â•‘
â•‘                                                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## Component Interaction Matrix

```
                â”‚ Can Call â”‚ Can Create â”‚ Can Access â”‚ Can Share â”‚
                â”‚   These  â”‚   Workers  â”‚    DOM     â”‚  Memory   â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
Service Worker  â”‚  chrome  â”‚     âœ—      â”‚     âœ—      â”‚  Via msgs â”‚
Content Script  â”‚ DOM +    â”‚     âœ“      â”‚     âœ“      â”‚  Via msgs â”‚
                â”‚ chrome   â”‚            â”‚            â”‚           â”‚
Web Worker      â”‚ postMsg  â”‚     âœ“      â”‚     âœ—      â”‚  Via msgs â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
```

---

**Key Takeaway:** Each component has exactly the APIs it needs, no more, no less. This is the Manifest V3 security model in action.
